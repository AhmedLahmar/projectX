/*
 Copyright (c) 2009, 2010 Jan Marek
 @copyright Copyright (c) 2009, 2010 David Grudl
 @copyright Copyright (c) 2012 Vojt?ch Dobe?
 @license MIT

 @version 1.2.2
*/
(function(k,e,h){if("function"!==typeof e)return console.error("nette.ajax.js: jQuery is missing, load it please");e.nette=new (e.extend(function(){var b={self:this,initialized:!1,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var a=!0,c=Array.prototype.slice.call(arguments),d=c.shift(),f="string"===typeof d?d:d.name,g="object"===typeof d?d.off||{}:{};c.push(b.self);e.each(b.on[f],function(d,f){if(f===h||-1!==e.inArray(d,g))return!0;
var m=f.apply(b.contexts[d],c);return a=m===h||m});return a},requestHandler:function(a){if((a=b.self.ajax({},this,a))&&a._returnFalse)return!1},ext:function(a,c,d){for(;!d;)d="ext_"+Math.random(),b.contexts[d]&&(d=h);e.each(a,function(a,c){b.on[a][d]=c});b.contexts[d]=e.extend(c?c:{},{name:function(){return d},ext:function(a,c){var d=b.contexts[a];if(!d&&c)throw"Extension '"+this.name()+"' depends on disabled extension '"+a+"'.";return d}})}};this.ext=function(a,c,d){if("object"===typeof a)b.ext(a,
c);else{if(c===h)return b.contexts[a];if(c){if("string"===typeof a&&b.contexts[a]!==h)throw"Cannot override already registered nette-ajax extension '"+a+"'.";b.ext(c,d,a)}else e.each("init load prepare before start success complete error".split(" "),function(c,d){b.on[d][a]=h}),b.contexts[a]=h}return this};this.init=function(a,c){if(b.initialized)throw"Cannot initialize nette-ajax twice.";if("function"===typeof a)this.ext("init",null),this.ext("init",{load:a},c);else if("object"===typeof a)this.ext("init",
null),this.ext("init",a,c);else if(a!==h)throw"Argument of init() can be function or function-hash only.";b.initialized=!0;b.fire("init");this.load();return this};this.load=function(){b.fire("load",b.requestHandler);return this};this.ajax=function(a,c,d){if(!a.nette&&c&&d){var f=e(c),g;d=a.nette={e:d,ui:c,el:f,isForm:f.is("form"),isSubmit:f.is("input[type=submit]")||f.is("button[type=submit]"),isImage:f.is("input[type=image]"),form:null};d.isSubmit||d.isImage?d.form=d.el.closest("form"):d.isForm&&
(d.form=d.el);a.url||(a.url=d.form?d.form.attr("action"):c.href);a.type||(a.type=d.form?d.form.attr("method"):"get");f.is("[data-ajax-off]")&&(c=f.attr("data-ajax-off"),0===c.indexOf("[")?a.off=f.data("ajaxOff"):-1!==c.indexOf(",")?a.off=c.split(","):-1!==c.indexOf(" ")?a.off=c.split(" "):a.off=c,"string"===typeof a.off&&(a.off=[a.off]),a.off=e.grep(e.each(a.off,function(a){return e.trim(a)}),function(a){return a.length}))}b.fire({name:"prepare",off:a.off||{}},a);a.prepare&&a.prepare(a);g=a.beforeSend;
a.beforeSend=function(a,c){var d=b.fire({name:"before",off:c.off||{}},a,c);(d||d===h)&&g&&(d=g(a,c));return d};return this.handleXHR(e.ajax(a),a)};this.handleXHR=function(a,c){c=c||{};!a||"undefined"!==typeof a.statusText&&"canceled"===a.statusText||(a.done(function(a,e,g){b.fire({name:"success",off:c.off||{}},a,e,g,c)}).fail(function(a,e,g){b.fire({name:"error",off:c.off||{}},a,e,g,c)}).always(function(a,e){b.fire({name:"complete",off:c.off||{}},a,e,c)}),b.fire({name:"start",off:c.off||{}},a,c),
c.start&&c.start(a,c));return a}},e.nette?e.nette:{}));e.fn.netteAjax=function(b,a){return e.nette.ajax(a||{},this[0],b)};e.fn.netteAjaxOff=function(){return this.off(".nette")};e.nette.ext("validation",{before:function(b,a){if(a.nette)var c=a.nette;else return!0;var d=c.e,f=e.extend({keys:!0,url:!0,form:!0},a.validate||function(){if(c.el.is("[data-ajax-validate]")){var a=c.el.data("ajaxValidate");if(!1===a)return{keys:!1,url:!1,form:!1};if("object"===typeof a)return a}}()||{}),g=!1;c.el.attr("data-ajax-pass")!==
h&&(g=c.el.data("ajaxPass"),g="bool"===typeof g?g:!0);if(f.keys){var l=d.button||d.ctrlKey||d.shiftKey||d.altKey||d.metaKey;if(c.form){if(l&&c.isSubmit)return this.explicitNoAjax=!0,!1;if(c.isForm&&this.explicitNoAjax)return this.explicitNoAjax=!1}else if(l)return!1}if(f.form&&c.form&&(!c.isSubmit&&!c.isImage||c.el.attr("formnovalidate")===h)&&c.form.get(0).onsubmit&&!1===c.form.get(0).onsubmit(d))return d.stopImmediatePropagation(),d.preventDefault(),!1;if(f.url&&/:|^#/.test(c.form?a.url:c.el.attr("href")))return!1;
g||(d.stopPropagation(),d.preventDefault(),b._returnFalse=!0);return!0}},{explicitNoAjax:!1});e.nette.ext("forms",{init:function(){var b;k.Nette&&(b=this.ext("snippets"))&&b.after(function(a){a.find("form").each(function(){k.Nette.initForm(this)})})},prepare:function(b){var a=b.nette;if(a&&a.form){var c=a.e,d=b.data||{},f={};if(a.isSubmit)f[a.el.attr("name")]=a.el.val()||"";else if(a.isImage){var g=a.el.offset(),h=a.el.attr("name"),c=[Math.max(0,c.pageX-g.left),Math.max(0,c.pageY-g.top)];-1!==h.indexOf("[",
0)?f[h]=c:(f[h+".x"]=c[0],f[h+".y"]=c[1])}"string"!==typeof d&&(d=e.param(d));f=e.param(f);b.data=a.form.serialize()+(f?"&"+f:"")+"&"+d}}});e.nette.ext("snippets",{success:function(b){b.snippets&&this.updateSnippets(b.snippets)}},{beforeQueue:e.Callbacks(),afterQueue:e.Callbacks(),completeQueue:e.Callbacks(),before:function(b){this.beforeQueue.add(b)},after:function(b){this.afterQueue.add(b)},complete:function(b){this.completeQueue.add(b)},updateSnippets:function(b,a){var c=this,d=[],f;for(f in b){var g=
this.getElement(f);g.get(0)&&d.push(g.get(0));this.updateSnippet(g,b[f],a)}e(d).promise().done(function(){c.completeQueue.fire()})},updateSnippet:function(b,a,c){b.is("title")?document.title=a:(this.beforeQueue.fire(b),this.applySnippet(b,a,c),this.afterQueue.fire(b))},getElement:function(b){return e("#"+this.escapeSelector(b))},applySnippet:function(b,a,c){!c&&b.is("[data-ajax-append]")?b.append(a):b.html(a)},escapeSelector:function(b){return b.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,
"\\$&")}});e.nette.ext("redirect",{success:function(b){if(b.redirect)return k.location.href=b.redirect,!1}});e.nette.ext("state",{success:function(b){b.state&&(this.state=b.state)}},{state:null});e.nette.ext("unique",{start:function(b){this.xhr&&this.xhr.abort();this.xhr=b},complete:function(){this.xhr=null}},{xhr:null});e.nette.ext("abort",{init:function(){e("body").keydown(e.proxy(function(b){!this.xhr||("27"!==b.keyCode.toString()||b.ctrlKey||b.shiftKey||b.altKey||b.metaKey)||this.xhr.abort()},
this))},start:function(b){this.xhr=b},complete:function(){this.xhr=null}},{xhr:null});e.nette.ext("load",{success:function(){e.nette.load()}});e.nette.ext("init",{load:function(b){e(this.linkSelector).off("click.nette",b).on("click.nette",b);e(this.formSelector).off("submit.nette",b).on("submit.nette",b).off("click.nette",":image",b).on("click.nette",":image",b).off("click.nette",":submit",b).on("click.nette",":submit",b);e(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,
b).on("click.nette",this.buttonSelector,b)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})})(window,window.jQuery);
(function(a,b){a.nette.ext("spinner",{init:function(){this.spinner=this.createSpinner();this.spinner.appendTo("body")},start:function(){this.spinner.show(this.speed)},complete:function(){this.spinner.hide(this.speed)}},{createSpinner:function(){return a("<div>",{id:"ajax-spinner",css:{display:"none"}})},spinner:null,speed:b})})(jQuery);
(function(a){a.nette.ext("flash_messages",{load:function(){a(".alert.hidable").each(function(b,c){var d=a(c);if(!d.children(".close:first").length){d.addClass("alert-dismissable");a("<button />").attr("type","button").addClass("close").attr("data-dismiss","alert").attr("aria-hidden","true").html("&times;").prependTo(d);var d=a("html").scrollTop()||a("body").scrollTop(),e=a(".alert.hidable:first").offset().top+1;d>e&&a("html, body").animate({scrollTop:e},600)}})}});a.nette.ext("anchor_sliding",{load:function(){a('a[href*="#"].scr').off("click.anchor_sliding").on("click.anchor_sliding",
function(b){b.preventDefault();var c=a(this).attr("href");b=c.split("#",2)[1];var d=a("#"+b);2>b.length||(d.length?a("html, body").animate({scrollTop:d.offset().top},512,function(){window.location.href=c}):window.location.href=c)})}});a.nette.ext("sliding",{success:function(b){if(b.anchor){var c=a("#"+b.anchor);c.length&&a("html, body").animate({scrollTop:c.offset().top},512,function(){window.location.href="#"+b.anchor})}}});a(function(){a.nette.init()})})(window.jQuery);
(function(a){a(function(){})})(window.jQuery);
